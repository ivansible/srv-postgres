---
# defaults file for ivansible.srv_postgres

srv_pg_release: 10
srv_pg_service: postgresql@{{ srv_pg_release }}-main

srv_pg_conf_root: /etc/postgresql
srv_pg_conf_dir: "{{ srv_pg_conf_root }}/{{ srv_pg_release }}/main"

srv_pg_host: localhost
srv_pg_port: 5432

srv_pg_admin_password: pg_secret

# note: by default nginx ssl certificate is a "snakeoil" certificate
#       generated by ssl-cert ubuntu package during installation.
srv_pg_ssl_cert: "{{ nginx_ssl_cert }}"
srv_pg_ssl_key: "{{ nginx_ssl_key }}"

srv_pg_local_subnets: []

srv_pg_timezone: UTC
srv_pg_locale: en_US.UTF-8

srv_pg_parameters:
  listen_addresses: "'*'"
  port: "{{ srv_pg_port }}"
  max_connections: 20
  ssl: "on"
  ssl_ciphers: "'HIGH:MEDIUM:+3DES:!aNULL'"
  ssl_prefer_server_ciphers: "on"
  ssl_cert_file: "'{{ srv_pg_ssl_cert }}'"
  ssl_key_file: "'{{ srv_pg_ssl_key }}'"
  shared_buffers: "32MB"
  temp_buffers: "16MB"
  max_prepared_transactions: 0
  work_mem: "12MB"
  maintenance_work_mem: "32MB"
  max_stack_depth: "1MB"
  vacuum_cost_delay: 0
  commit_delay: 10000
  checkpoint_timeout: "5min"
  random_page_cost: "2.0"
  track_activities: "on"
  track_counts: "on"
  timezone: "'{{ srv_pg_timezone }}'"
  log_timezone: "'{{ srv_pg_timezone }}'"
  lc_messages: "'{{ srv_pg_locale }}'"
  lc_monetary: "'{{ srv_pg_locale }}'"
  lc_numeric: "'{{ srv_pg_locale }}'"
  lc_time: "'{{ srv_pg_locale }}'"

srv_pg_kernel_params:
  # Controls the default maxmimum size of a message queue
  kernel.msgmnb: 65536
  # Controls the maximum size of a message, in bytes
  kernel.msgmax: 65536
  # Controls the maximum shared segment size, in bytes
  # DANGER!!! I suspect too high value here can crash system
  #~kernel.shmmax = 68719476736
  # More conservative value is 512mb which is 50% of 1GB VPS RAM
  kernel.shmmax: 536870912
...
